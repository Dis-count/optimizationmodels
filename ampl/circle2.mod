# packing circles in rectangle

param n = 126;
param l = 471;
param w = 196;

set dim = 1..n;

var x {dim};
var y {dim};
var r >= 0;

maximize robj: r;

subject to distance{i in dim, j in dim: j > i}:
    (x[i] - x[j])^2 + (y[i] - y[j])^2 >= 4*r^2;

subject to xbup {i in dim}:
    x[i] <= l - r;

subject to xblow {i in dim}:
    x[i] >= r;

subject to ybup {i in dim}:
    y[i] <= w - r;

subject to yblow {i in dim}:
    y[i] >= r;

option log_file "circle2.log";

# option solver knitro;
# option knitro_options 'outlev 0 par_numthreads 4 linsolver 6';

option solver ipopt;
option ipopt_options 'linear_solver pardiso';

solve;

printf "\n\n       ********Solution Report********       \n";
printf "\nObjective:\n";
printf "  %.12f\n", robj;
printf "\nVariables:\n";
printf "  Dim                X                   Y\n";
for {i in dim} {
    printf "  %-3d      %18.12f    %18.12f\n", i, x[i], y[i];
}

exit;

# Current best known solution obtained by Ipopt with pardiso as linear solver, 4 threads
# 
#       ********Solution Report********       
#
#Objective:
#  14.005166318974
#
#Variables:
#  Dim                X                   Y
#  1           30.763996936231      181.994834967071
#  2           58.774336851277      181.994834925280
#  3           56.020680614400       38.262825456825
#  4           14.005167276539      111.035800232333
#  5          142.805363358318      133.479519034610
#  6           58.774337489728      133.479517532031
#  7          114.795020817401      133.479518882183
#  8          114.795021429455       84.964202058304
#  9          100.789850288995      109.221860260530
#  10          70.025851613659       14.005167054673
#  11         159.564190948208       62.520484577252
#  12          72.779507530333      157.737176415185
#  13          28.010337797300       86.778141754391
#  14          14.005167285401       62.520483288694
#  15         100.789849465108      157.737176922376
#  16         173.569362135703       86.778142817505
#  17         114.795020672191      181.994835007702
#  18          44.769166765729      157.737175996905
#  19          42.015509616781       62.520483854368
#  20         128.800192090050      157.737177060203
#  21          86.784680198653       84.964201374784
#  22          28.010338934569       38.262825479600
#  23         142.805363852084      181.994834945372
#  24         386.400604162796      157.737182668242
#  25         198.826049531266      181.994834793945
#  26         156.810533819548      109.221860544935
#  27         243.595217578084      111.035797933083
#  28         302.369557853085      109.221860582740
#  29         170.815706036184      133.479518410395
#  30         246.348874630291      157.737175708211
#  31          86.784679009500      133.479518392641
#  32         456.711393995716      180.723440517624
#  33         187.574530889637       14.005166939113
#  34         285.610736976754       38.262824950895
#  35         400.406263063458      181.994710862925
#  36         128.800192016310      109.221860765384
#  37         201.579701816448       38.262825147079
#  38         260.354043995117      181.994834951363
#  39         173.569360783801       38.262825671447
#  40         344.385071214655      181.994835024426
#  41         184.820878251895      157.737176322068
#  42          14.005167314934      159.551118162796
#  43         170.815707282100      181.994834858730
#  44         302.369553031472      157.737176476387
#  45          28.010337025152      135.293459156075
#  46         156.810535359383      157.737176920519
#  47         428.416758317213      181.994830883034
#  48         142.805362479747       84.964202225294
#  49         215.584872582681       14.005166887586
#  50          56.020679676390       86.778142606144
#  51         316.374726778525      133.479520029146
#  52         114.795021704622       36.448884529966
#  53         229.590046473466       86.778139869193
#  54         131.553850429899       14.005167008909
#  55         243.595217498302       62.520481287683
#  56         100.789851238683       60.706543127647
#  57         215.584876303735      111.035798937974
#  58          72.779509058181      109.221859566676
#  59         299.615910750300       14.005167416028
#  60         274.359215439814      109.221857941460
#  61         145.559020520652       38.262825884655
#  62         347.138731118361       38.262827466212
#  63         375.149067545381       38.262827240371
#  64         215.584877464841      159.551116376021
#  65         375.149073572834       86.778149747931
#  66         344.385071249667      133.479523369109
#  67         271.605564654656       14.005167130990
#  68         187.574531845683       62.520483895848
#  69          42.015509755484       14.005167021206
#  70         257.600388646815       86.778139220974
#  71          42.015507906631      111.035800619437
#  72          70.025850895748       62.520484231144
#  73         229.590047422816      135.293457109588
#  74         128.800191919774       60.706543476748
#  75         288.364384167285      133.479517269916
#  76          14.005167917262       14.005167434225
#  77         201.579704049773       86.778141435422
#  78          84.031022057419       38.262825817667
#  79         187.574534265535      111.035800472353
#  80         302.369563386346       60.706544535396
#  81         201.579706370849      135.293458121362
#  82         159.564190484429       14.005166988142
#  83          98.036192664091       14.005167086651
#  84         288.364382850925      181.994835045100
#  85          86.784678100650      181.994834966739
#  86         243.595217821061       14.005166974247
#  87         274.359213651773      157.737175855819
#  88         372.395422689838      181.994834915599
#  89         229.590044934479       38.262824159526
#  90         330.379896502377      157.737178991255
#  91         358.390246572662      157.737179390074
#  92         288.364389091427       84.964201025513
#  93         232.343704884319      181.994834904106
#  94         271.605562447691       62.520481949800
#  95         316.374722688341      181.994835174964
#  96         260.354044591893      133.479516575319
#  97         257.600390826658       38.262824063423
#  98         215.584874082315       62.520482551387
#  99         330.379901402456      109.221864104547
#  100        372.395424427102      133.479525219005
#  101        406.251220033131      137.975303846553
#  102        456.994837802692       49.109162023459
#  103        316.374736979265       36.448887643649
#  104        417.141692800642      112.168785145616
#  105        333.133562006298       14.005167215059
#  106        389.154235346790       14.005166974624
#  107        389.154276142757      111.035824936579
#  108        361.143900962640       62.520488095471
#  109        361.143898979542       14.005167142483
#  110        330.379906351439       60.706547895289
#  111        344.385075972865       84.964208161793
#  112        316.374732324584       84.964204364792
#  113        429.227487838459      153.996228737517
#  114        358.390246690245      109.221868169346
#  115        417.164573655273       14.005167199887
#  116        455.532870278899       15.330244349559
#  117        431.146820225276       87.911101728586
#  118        403.159408991223       86.778144634694
#  119        389.154236668062       62.520487208948
#  120        418.025283767978       63.016663117141
#  121        456.994834863634      150.314736017812
#  122        403.159403228724       38.262826908811
#  123        440.436871787245      127.722394126256
#  124        456.994722288944      105.129913810207
#  125        456.994837796395       77.119496062052
#  126        431.169736643189       38.262830156504